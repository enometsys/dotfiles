# Include project specific config
Include config.d/*

# With gpg agent forwarding (for using local gpg keys) and ssh forwarding (for using local ssh keys)
# gpg-agent-forwarding
# - https://wiki.gnupg.org/AgentForwarding
# - https://mlohr.com/gpg-agent-forwarding/
# - https://www.ecliptik.com/Forwarding-gpg-agent-over-SSH/
# - https://coder.com/docs/coder/v1.23/guides/customization/gpg-forwarding (troubleshooting)
# Host trusted.vm
#   HostName 192.168.0.1
#   User trusted
#   Port 22
#   ForwardAgent yes
#   Compression yes
#   ForwardX11 yes
#   ForwardX11Trusted yes
#   RemoteForward /run/user/1001/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra
# troubleshooting "No secret key" (gpg: [stdin]: clear-sign failed: No secret key)
# - Run gpgconf --kill gpg-agent
# - Use ps ax | grep gpg-agent to find and kill all of the pids.
# - Reconnect ssh session to re-establish the socket forwarding.

# fix for pinentry popping up on random panes when git pull/pushing
# from https://unix.stackexchange.com/questions/554153/what-is-the-proper-configuration-for-gpg-ssh-and-gpg-agent-to-use-gpg-auth-sub
Host localhost
  ForwardAgent yes
  AddKeysToAgent ask
  Match host * exec "gpg-connect-agent UPDATESTARTUPTTY /bye"

# fallbacks
Host *
  # fix for keeping ssh connections alive
  TCPKeepAlive true
  ServerAliveInterval 60
  # for selectively selecting trusted remotes (security)
  ForwardX11 no
  ForwardAgent no
